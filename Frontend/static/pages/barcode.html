<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Document</title>
    <link rel="stylesheet" href="../css/barcode.css">
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css"
    />
  </head>
  <body>
    <!-- Authentication Check -->
   <!-- Authentication Check -->
    <script>
        // Check if user is logged in
        if (!localStorage.getItem('isLoggedIn') || localStorage.getItem('isLoggedIn') !== 'true') {
            window.location.href = 'login.html';
        }

        // Get current user
        const currentUser = JSON.parse(localStorage.getItem('currentUser'));
        if (!currentUser) {
            window.location.href = 'login.html';
        }
    </script>

    <!-- Sidebar -->
    <div class="sidebar" id="sidebar">
        <div class="sidebar-header">
            <div class="logo">
                <div class="logo-icon">
                    <i class="fas fa-boxes"></i>
                </div>
                <div class="logo-text">InventoryPro</div>
            </div>
            <button class="toggle-btn" id="sidebarToggle">
                <i class="fas fa-chevron-left"></i>
            </button>
        </div>

         <div class="sidebar-menu">
            <a href="./dashboard.html" class="menu-item active">
                <i class="fas fa-tachometer-alt"></i>
                <span>Dashboard</span>
            </a>

            <a href="./update-category.html" class="menu-item">
                <i class="fas fa-box-open"></i>
                <span>Product Management</span>
            </a>

            <a href="./stockmanagement.html" class="menu-item">
                <i class="fas fa-warehouse"></i>
                <span>Stock Management</span>
            </a>

            <a href="./category-management.html" class="menu-item">
                <i class="fas fa-tags"></i>
                <span>Category Management</span>
            </a>

            <a href="./supplier.html" class="menu-item">
                <i class="fas fa-truck"></i>
                <span>Supplier Management</span>
            </a>

            <a href="./purchase.html" class="menu-item">
                <i class="fas fa-shopping-cart"></i>
                <span>Purchase Management</span>
            </a>

            <a href="./sale.html" class="menu-item">
                <i class="fas fa-chart-line"></i>
                <span>Sales Management</span>
            </a>

            <a href="./detailed-analytics.html" class="menu-item">
                <i class="fas fa-chart-bar"></i>
                <span>Analytics & Reports</span>
            </a>

            <a href="./user-management.html" class="menu-item">
                <i class="fas fa-users"></i>
                <span>User Management</span>
            </a>
            <a href="./back-up.html" class="menu-item">
                <i class="fas fa-database"></i>
                <span>Backup & Export</span>
            </a>
            <a href="./barcode.html " class="menu-item">
                <i class="fas fa-barcode"></i>
                <span>Barcode Scanner</span>
            </a>
            <a href="./notification.html " class="menu-item">
                <i class="fas fa-bell"></i>
                <span>Notification</span>
            </a>

            <a href="#" class="menu-item" id="logoutSidebar">
                <i class="fas fa-sign-out-alt"></i>
                <span>Logout</span>
            </a>
        </div>
    </div>
    <!-- Main Content -->
    <div class="main-content" id="mainContent">
        <!-- Header -->
        <div class="header">
            <div class="header-left">
                <button class="mobile-menu-toggle" id="mobileMenuToggle">
                    <i class="fas fa-bars"></i>
                </button>
                <h1 id="pageTitle">Barcode Scanner</h1>
            </div>

            <div class="header-right">
                <div class="user-profile">
                    <div class="user-avatar" id="userAvatar">
                        <!-- Initial will be set by JavaScript -->
                    </div>
                    <button class="logout-btn" id="logoutBtn">
                        <i class="fas fa-sign-out-alt"></i> Logout
                    </button>
                </div>
            </div>
        </div>

        <!-- Content -->
        <div class="content">
            <!-- Page Header -->
            <div class="page-header">
                <div>
                    <h1 class="page-title">Barcode Scanner</h1>
                    <p class="page-subtitle">Scan barcodes to quickly look up products and manage inventory</p>
                </div>
                <div class="scanner-status" id="scannerStatus">
                    <div class="status-indicator status-inactive" id="statusIndicator"></div>
                    <span id="statusText">Scanner inactive</span>
                </div>
            </div>

            <!-- Scanner Stats -->
            <div class="scanner-stats">
                <div class="stat-card">
                    <div class="stat-icon">
                        <i class="fas fa-barcode"></i>
                    </div>
                    <div class="stat-details">
                        <div class="stat-value" id="totalScansToday">0</div>
                        <div class="stat-label">Scans Today</div>
                    </div>
                </div>

                <div class="stat-card">
                    <div class="stat-icon" style="background: rgba(39, 174, 96, 0.1); color: var(--success-color);">
                        <i class="fas fa-check-circle"></i>
                    </div>
                    <div class="stat-details">
                        <div class="stat-value" id="successfulScans">0</div>
                        <div class="stat-label">Successful Scans</div>
                    </div>
                </div>

                <div class="stat-card">
                    <div class="stat-icon" style="background: rgba(243, 156, 18, 0.1); color: var(--warning-color);">
                        <i class="fas fa-exclamation-triangle"></i>
                    </div>
                    <div class="stat-details">
                        <div class="stat-value" id="notFoundScans">0</div>
                        <div class="stat-label">Products Not Found</div>
                    </div>
                </div>

                <div class="stat-card">
                    <div class="stat-icon" style="background: rgba(231, 76, 60, 0.1); color: var(--accent-color);">
                        <i class="fas fa-times-circle"></i>
                    </div>
                    <div class="stat-details">
                        <div class="stat-value" id="failedScans">0</div>
                        <div class="stat-label">Failed Scans</div>
                    </div>
                </div>
            </div>

            <!-- Scanner Container -->
            <div class="scanner-container">
                <div class="scanner-header">
                    <div class="scanner-title">
                        <i class="fas fa-camera"></i> Barcode Scanner
                    </div>
                    <div class="scanner-controls">
                        <button class="btn btn-outline" id="cameraSelectBtn">
                            <i class="fas fa-camera"></i> Change Camera
                        </button>
                        <button class="btn btn-primary" id="startScannerBtn">
                            <i class="fas fa-play"></i> Start Scanner
                        </button>
                        <button class="btn btn-danger" id="stopScannerBtn" style="display: none;">
                            <i class="fas fa-stop"></i> Stop Scanner
                        </button>
                    </div>
                </div>

                <div class="scanner-body">
                    <div id="reader" style="display: none;"></div>

                    <div class="scanner-placeholder" id="scannerPlaceholder">
                        <i class="fas fa-barcode"></i>
                        <h3>Ready to Scan</h3>
                        <p>Click "Start Scanner" to activate the barcode scanner</p>
                        <p class="small-text" style="font-size: 14px; margin-top: 10px;">Position barcode within the
                            frame for best results</p>
                    </div>

                    <div class="scanner-overlay" id="scannerOverlay" style="display: none;">
                        <div class="scanner-frame"></div>
                    </div>
                </div>
            </div>

            <!-- Scan Results -->
            <div class="scan-results" id="scanResults" style="display: none;">
                <div class="results-header">
                    <h3 class="results-title">
                        <i class="fas fa-check-circle"></i> Scan Result
                    </h3>
                    <button class="btn btn-outline" id="clearResultBtn">
                        <i class="fas fa-times"></i> Clear
                    </button>
                </div>

                <div class="results-body">
                    <div class="product-image">
                        <i class="fas fa-box" id="productImageIcon"></i>
                    </div>

                    <div class="product-details">
                        <h2 class="product-name" id="productName">Product Name</h2>
                        <div class="product-sku" id="productSku">SKU: </div>

                        <div class="product-info-grid">
                            <div class="info-item">
                                <div class="info-label">Category</div>
                                <div class="info-value" id="productCategory">-</div>
                            </div>

                            <div class="info-item">
                                <div class="info-label">Price</div>
                                <div class="info-value" id="productPrice">â‚¹0.00</div>
                            </div>

                            <div class="info-item">
                                <div class="info-label">Current Stock</div>
                                <div class="info-value" id="productStock">0 units</div>
                            </div>

                            <div class="info-item">
                                <div class="info-label">Min Stock</div>
                                <div class="info-value" id="productMinStock">0 units</div>
                            </div>
                        </div>

                        <div class="stock-level">
                            <div class="stock-bar">
                                <div class="stock-fill" id="stockFill" style="width: 0%;"></div>
                            </div>
                            <div class="stock-info">
                                <span>Stock Level</span>
                                <span id="stockPercentage">0%</span>
                            </div>
                        </div>

                        <div class="action-buttons">
                            <button class="btn btn-primary" id="viewProductBtn">
                                <i class="fas fa-eye"></i> View Product
                            </button>
                            <button class="btn btn-success" id="stockInBtn">
                                <i class="fas fa-plus"></i> Stock In
                            </button>
                            <button class="btn btn-warning" id="stockOutBtn">
                                <i class="fas fa-minus"></i> Stock Out
                            </button>
                            <button class="btn btn-outline" id="adjustStockBtn">
                                <i class="fas fa-edit"></i> Adjust Stock
                            </button>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Product Not Found -->
            <div class="scan-results" id="productNotFound" style="display: none;">
                <div class="results-header">
                    <h3 class="results-title">
                        <i class="fas fa-exclamation-triangle"></i> Product Not Found
                    </h3>
                    <button class="btn btn-outline" id="clearNotFoundBtn">
                        <i class="fas fa-times"></i> Clear
                    </button>
                </div>

                <div class="results-body">
                    <div class="product-image">
                        <i class="fas fa-question-circle" style="color: var(--warning-color);"></i>
                    </div>

                    <div class="product-details">
                        <h2 class="product-name">Product Not Found</h2>
                        <p style="color: #7f8c8d; margin-bottom: 20px;">The scanned barcode doesn't match any product in
                            the inventory.</p>

                        <div class="info-item"
                            style="background: #fff8e1; border-left: 4px solid var(--warning-color);">
                            <div class="info-label">Scanned Barcode</div>
                            <div class="info-value" id="scannedBarcode">-</div>
                        </div>

                        <div class="action-buttons">
                            <button class="btn btn-primary" id="addNewProductBtn">
                                <i class="fas fa-plus"></i> Add as New Product
                            </button>
                            <button class="btn btn-outline" id="tryAgainBtn">
                                <i class="fas fa-redo"></i> Try Again
                            </button>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Manual Entry -->
            <div class="manual-entry">
                <h3 class="manual-header">
                    <i class="fas fa-keyboard"></i> Manual Barcode Entry
                </h3>
                <p style="color: #7f8c8d; margin-bottom: 20px;">Enter a barcode manually if the scanner is not working
                    or for testing purposes.</p>

                <div class="form-group">
                    <label for="manualBarcode">Barcode / SKU</label>
                    <input type="text" id="manualBarcode" class="form-control"
                        placeholder="Enter barcode or product SKU">
                </div>

                <button class="btn btn-primary" id="manualLookupBtn">
                    <i class="fas fa-search"></i> Lookup Product
                </button>
            </div>

            <!-- Recent Scans -->
            <div class="recent-scans">
                <div class="recent-header">
                    <h3 class="recent-title">
                        <i class="fas fa-history"></i> Recent Scans
                    </h3>
                    <button class="btn btn-outline" id="clearHistoryBtn">
                        <i class="fas fa-trash"></i> Clear History
                    </button>
                </div>

                <div class="scans-list" id="scansList">
                    <!-- Recent scans will be populated by JavaScript -->
                </div>

                <div style="text-align: center; padding: 20px; color: #7f8c8d;" id="noScansMessage">
                    <i class="fas fa-history" style="font-size: 40px; margin-bottom: 10px;"></i>
                    <p>No recent scans. Start scanning to see history here.</p>
                </div>
            </div>
        </div>
    </div>

    <!-- Camera Selection Modal -->
    <div class="modal" id="cameraModal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 class="modal-title">Select Camera</h3>
                <button class="modal-close" id="closeCameraModal">&times;</button>
            </div>
            <div class="modal-body">
                <div class="camera-selection">
                    <div class="form-group">
                        <label for="cameraSelect">Available Cameras</label>
                        <div class="camera-list" id="cameraList">
                            <!-- Cameras will be populated by JavaScript -->
                        </div>
                    </div>

                    <div class="form-actions"
                        style="display: flex; justify-content: flex-end; gap: 15px; margin-top: 30px;">
                        <button class="btn" id="cancelCameraBtn">Cancel</button>
                        <button class="btn btn-primary" id="selectCameraBtn">
                            <i class="fas fa-check"></i> Select Camera
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Stock Adjustment Modal -->
    <div class="modal" id="stockModal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 class="modal-title" id="stockModalTitle">Stock Adjustment</h3>
                <button class="modal-close" id="closeStockModal">&times;</button>
            </div>
            <div class="modal-body">
                <form id="stockForm">
                    <div class="form-group">
                        <label for="adjustProductName">Product</label>
                        <input type="text" id="adjustProductName" class="form-control" readonly>
                    </div>

                    <div class="form-row">
                        <div class="form-group">
                            <label for="adjustType">Adjustment Type</label>
                            <select id="adjustType" class="form-control" required>
                                <option value="in">Stock In (Add)</option>
                                <option value="out">Stock Out (Remove)</option>
                                <option value="set">Set Stock Level</option>
                            </select>
                        </div>

                        <div class="form-group">
                            <label for="adjustQuantity">Quantity</label>
                            <input type="number" id="adjustQuantity" class="form-control" min="1" value="1" required>
                        </div>
                    </div>

                    <div class="form-group">
                        <label for="adjustReason">Reason</label>
                        <select id="adjustReason" class="form-control" required>
                            <option value="">Select Reason</option>
                            <option value="purchase">Purchase/Receipt</option>
                            <option value="sale">Sale/Order</option>
                            <option value="return">Customer Return</option>
                            <option value="damaged">Damaged Goods</option>
                            <option value="expired">Expired Products</option>
                            <option value="found">Found Items</option>
                            <option value="theft">Theft/Loss</option>
                            <option value="count_error">Counting Error</option>
                            <option value="other">Other</option>
                        </select>
                    </div>

                    <div class="form-group">
                        <label for="adjustNotes">Notes</label>
                        <textarea id="adjustNotes" class="form-control" rows="3"
                            placeholder="Additional notes about this adjustment..."></textarea>
                    </div>

                    <div class="form-actions"
                        style="display: flex; justify-content: flex-end; gap: 15px; margin-top: 30px;">
                        <button type="button" class="btn" id="cancelStockBtn">Cancel</button>
                        <button type="submit" class="btn btn-primary">
                            <i class="fas fa-check"></i> Apply Adjustment
                        </button>
                    </div>
                </form>
            </div>
        </div>
    </div>
    <script src="../js/barcode.js"></script>
  </body>
</html>
