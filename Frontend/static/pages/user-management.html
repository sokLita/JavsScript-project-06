<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>InventoryPro | User Management</title>
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css"
    />
    <link rel="stylesheet" href="../css/user-management.css" />
  </head>

  <body>
    <!-- Authentication and Authorization Check -->
    <script>
      // Check if user is logged in
      if (
        !localStorage.getItem("isLoggedIn") ||
        localStorage.getItem("isLoggedIn") !== "true"
      ) {
        window.location.href = "login.html";
      }

      // Get current user
      const currentUser = JSON.parse(localStorage.getItem("currentUser"));
      if (!currentUser) {
        window.location.href = "login.html";
      }

      // Check if user is admin (only admins can access user management)
      if (currentUser.role !== "admin") {
        alert("Access denied. This page is only accessible to administrators.");
        window.location.href = "dashboard.html";
      }
    </script>

    <!-- Sidebar -->
    <div class="sidebar" id="sidebar">
      <div class="sidebar-header">
        <div class="logo">
          <div class="logo-icon">
            <i class="fas fa-boxes"></i>
          </div>
          <div class="logo-text">InventoryPro</div>
        </div>
        <button class="toggle-btn" id="sidebarToggle">
          <i class="fas fa-chevron-left"></i>
        </button>
      </div>

     <div class="sidebar-menu">
            <a href="./dashboard.html" class="menu-item active">
                <i class="fas fa-tachometer-alt"></i>
                <span>Dashboard</span>
            </a>

            <a href="./update-category.html" class="menu-item">
                <i class="fas fa-box-open"></i>
                <span>Product Management</span>
            </a>

            <a href="./stockmanagement.html" class="menu-item">
                <i class="fas fa-warehouse"></i>
                <span>Stock Management</span>
            </a>

            <a href="./category-management.html" class="menu-item">
                <i class="fas fa-tags"></i>
                <span>Category Management</span>
            </a>

            <a href="./supplier.html" class="menu-item">
                <i class="fas fa-truck"></i>
                <span>Supplier Management</span>
            </a>

            <a href="./purchase.html" class="menu-item">
                <i class="fas fa-shopping-cart"></i>
                <span>Purchase Management</span>
            </a>

            <a href="./sale.html" class="menu-item">
                <i class="fas fa-chart-line"></i>
                <span>Sales Management</span>
            </a>

            <a href="./detailed-analytics.html" class="menu-item">
                <i class="fas fa-chart-bar"></i>
                <span>Analytics & Reports</span>
            </a>

            <a href="./user-management.html" class="menu-item">
                <i class="fas fa-users"></i>
                <span>User Management</span>
            </a>
            <a href="./back-up.html" class="menu-item">
                <i class="fas fa-database"></i>
                <span>Backup & Export</span>
            </a>
            <a href="./barcode.html " class="menu-item">
                <i class="fas fa-barcode"></i>
                <span>Barcode Scanner</span>
            </a>

            <a href="#" class="menu-item" id="logoutSidebar">
                <i class="fas fa-sign-out-alt"></i>
                <span>Logout</span>
            </a>
      </div>
    </div>

    <!-- Main Content -->
    <div class="main-content" id="mainContent">
      <!-- Header -->
      <div class="header">
        <div class="header-left">
          <button class="mobile-menu-toggle" id="mobileMenuToggle">
            <i class="fas fa-bars"></i>
          </button>
          <h1 id="pageTitle">User Management</h1>
        </div>

        <div class="header-right">
          <div class="user-profile">
            <div class="user-avatar" id="userAvatar">A</div>
            <button class="logout-btn" id="logoutBtn">
              <i class="fas fa-sign-out-alt"></i> Logout
            </button>
          </div>
        </div>
      </div>

      <!-- Content -->
      <div class="content">
        <!-- Page Header -->
        <div class="page-header">
          <div>
            <h1 class="page-title">User Management</h1>
            <p class="page-subtitle">
              Manage system users, roles, and permissions
            </p>
          </div>
          <button class="btn btn-primary" id="addUserBtn">
            <i class="fas fa-user-plus"></i> Add New User
          </button>
        </div>

        <!-- Stats Cards -->
        <div class="stats-cards">
          <div class="stat-card">
            <div class="stat-icon">
              <i class="fas fa-users"></i>
            </div>
            <div class="stat-details">
              <div class="stat-value" id="totalUsers">0</div>
              <div class="stat-label">Total Users</div>
            </div>
          </div>

          <div class="stat-card">
            <div
              class="stat-icon"
              style="
                background: rgba(39, 174, 96, 0.1);
                color: var(--success-color);
              "
            >
              <i class="fas fa-user-check"></i>
            </div>
            <div class="stat-details">
              <div class="stat-value" id="activeUsers">0</div>
              <div class="stat-label">Active Users</div>
            </div>
          </div>

          <div class="stat-card">
            <div
              class="stat-icon"
              style="
                background: rgba(52, 152, 219, 0.1);
                color: var(--secondary-color);
              "
            >
              <i class="fas fa-user-tie"></i>
            </div>
            <div class="stat-details">
              <div class="stat-value" id="adminUsers">0</div>
              <div class="stat-label">Administrators</div>
            </div>
          </div>

          <div class="stat-card">
            <div
              class="stat-icon"
              style="
                background: rgba(243, 156, 18, 0.1);
                color: var(--warning-color);
              "
            >
              <i class="fas fa-user-clock"></i>
            </div>
            <div class="stat-details">
              <div class="stat-value" id="managerUsers">0</div>
              <div class="stat-label">Managers</div>
            </div>
          </div>
        </div>

        <!-- Action Bar -->
        <div class="action-bar">
          <div class="search-box">
            <input
              type="text"
              class="search-input"
              id="searchInput"
              placeholder="Search users by name, email, or role..."
            />
            <i class="fas fa-search search-icon"></i>
          </div>

          <div class="filter-group">
            <select class="filter-select" id="roleFilter">
              <option value="">All Roles</option>
              <option value="admin">Administrator</option>
              <option value="manager">Manager</option>
              <option value="staff">Staff</option>
            </select>

            <select class="filter-select" id="statusFilter">
              <option value="">All Status</option>
              <option value="active">Active</option>
              <option value="inactive">Inactive</option>
              <option value="suspended">Suspended</option>
            </select>
          </div>
        </div>

        <!-- Users Table -->
        <div class="table-container">
          <table class="data-table">
            <thead>
              <tr>
                <th>User ID</th>
                <th>User</th>
                <th>Email</th>
                <th>Role</th>
                <th>Status</th>
                <th>Last Login</th>
                <th>Actions</th>
              </tr>
            </thead>
            <tbody id="usersTableBody">
              <!-- Users will be populated by JavaScript -->
            </tbody>
          </table>
        </div>

        <!-- User Activity Log -->
        <div
          style="
            background: white;
            border-radius: 10px;
            padding: 25px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.05);
          "
        >
          <h3
            style="
              font-size: 20px;
              font-weight: 600;
              color: var(--primary-color);
              margin-bottom: 20px;
              display: flex;
              align-items: center;
              gap: 10px;
            "
          >
            <i class="fas fa-history"></i> Recent User Activity
          </h3>
          <div class="activity-list" id="activityList">
            <!-- Activity will be populated by JavaScript -->
          </div>
        </div>
      </div>
    </div>

    <!-- Add/Edit User Modal -->
    <div class="modal" id="userModal">
      <div class="modal-content">
        <div class="modal-header">
          <h3 class="modal-title" id="modalTitle">Add New User</h3>
          <button class="modal-close" id="closeModal">&times;</button>
        </div>
        <div class="modal-body">
          <form id="userForm">
            <div class="form-row">
              <div class="form-group">
                <label for="firstName">First Name *</label>
                <input
                  type="text"
                  id="firstName"
                  class="form-control"
                  required
                />
              </div>

              <div class="form-group">
                <label for="lastName">Last Name *</label>
                <input
                  type="text"
                  id="lastName"
                  class="form-control"
                  required
                />
              </div>
            </div>

            <div class="form-row">
              <div class="form-group">
                <label for="username">Username *</label>
                <input
                  type="text"
                  id="username"
                  class="form-control"
                  required
                />
                <small style="color: #7f8c8d; font-size: 12px"
                  >This will be used for login</small
                >
              </div>

              <div class="form-group">
                <label for="email">Email Address *</label>
                <input type="email" id="email" class="form-control" required />
              </div>
            </div>

            <div class="form-row">
              <div class="form-group">
                <label for="password">Password *</label>
                <input
                  type="password"
                  id="password"
                  class="form-control"
                  required
                />
                <small style="color: #7f8c8d; font-size: 12px"
                  >Minimum 6 characters</small
                >
              </div>

              <div class="form-group">
                <label for="confirmPassword">Confirm Password *</label>
                <input
                  type="password"
                  id="confirmPassword"
                  class="form-control"
                  required
                />
              </div>
            </div>

            <div class="form-row">
              <div class="form-group">
                <label for="phone">Phone Number</label>
                <input type="tel" id="phone" class="form-control" />
              </div>

              <div class="form-group">
                <label for="department">Department</label>
                <input type="text" id="department" class="form-control" />
              </div>
            </div>

            <div class="form-row">
              <div class="form-group">
                <label for="role">Role *</label>
                <select id="role" class="form-control" required>
                  <option value="">Select Role</option>
                  <option value="admin">Administrator</option>
                  <option value="manager">Manager</option>
                  <option value="staff">Staff</option>
                </select>
              </div>

              <div class="form-group">
                <label for="status">Status *</label>
                <select id="status" class="form-control" required>
                  <option value="active">Active</option>
                  <option value="inactive">Inactive</option>
                  <option value="suspended">Suspended</option>
                </select>
              </div>
            </div>

            <div class="form-group">
              <label for="notes">Notes</label>
              <textarea
                id="notes"
                class="form-control"
                rows="3"
                placeholder="Add any additional notes about this user..."
              ></textarea>
            </div>

            <div class="form-actions">
              <button type="button" class="btn" id="cancelBtn">Cancel</button>
              <button type="submit" class="btn btn-primary" id="saveUserBtn">
                <i class="fas fa-save"></i> Save User
              </button>
            </div>
          </form>
        </div>
      </div>
    </div>

    <!-- User Details Modal -->
    <div class="modal" id="userDetailsModal">
      <div class="modal-content">
        <div class="modal-header">
          <h3 class="modal-title" id="detailsModalTitle">User Details</h3>
          <button class="modal-close" id="closeDetailsModal">&times;</button>
        </div>
        <div class="modal-body">
          <div id="userDetailsContent">
            <!-- User details will be populated by JavaScript -->
          </div>
        </div>
      </div>
    </div>

    <!-- Delete Confirmation Modal -->
    <div class="modal" id="deleteModal">
      <div class="modal-content" style="max-width: 500px">
        <div class="modal-header">
          <h3 class="modal-title">Confirm Delete</h3>
          <button class="modal-close" id="closeDeleteModal">&times;</button>
        </div>
        <div class="modal-body">
          <div style="text-align: center; padding: 20px">
            <i
              class="fas fa-exclamation-triangle"
              style="
                font-size: 60px;
                color: var(--accent-color);
                margin-bottom: 20px;
              "
            ></i>
            <h4 style="margin-bottom: 10px" id="deleteMessage">
              Are you sure you want to delete this user?
            </h4>
            <p style="color: #7f8c8d">
              This action cannot be undone. All user data will be permanently
              removed.
            </p>
          </div>
          <div class="form-actions">
            <button type="button" class="btn" id="cancelDeleteBtn">
              Cancel
            </button>
            <button type="button" class="btn btn-danger" id="confirmDeleteBtn">
              <i class="fas fa-trash"></i> Delete User
            </button>
          </div>
        </div>
      </div>
    </div>

    <script src="../js/user-management.js"></script>
  </body>
</html>
